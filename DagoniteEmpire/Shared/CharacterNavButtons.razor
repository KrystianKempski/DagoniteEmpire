@using Microsoft.AspNetCore.SignalR.Client
@inject IChatManager _chatManager
@inject IJSRuntime _jsRuntime
@inject ISnackbar _snackBar
@inject NavigationManager _navigationManager;
@inject IUserService _userService

@attribute [Authorize(Roles = SD.Role_Admin + "," + SD.Role_HeroPlayer + "," + SD.Role_DukePlayer + "," + SD.Role_GameMaster)]
<MudStack Wrap="Wrap.NoWrap" Spacing="@Spaceing" Row="@IsRow" AlignItems="AlignItems.Start">
    <MudButton OnClick="GoToCharacterList" Style="@($"color:{Color}; background:transparent;")" Variant="Variant.Text" DropShadow="true">
        <MudIcon Class="px-1" Icon="@Icons.Material.Filled.PeopleAlt"></MudIcon>
        Character list
    </MudButton>
    <MudButton OnClick="GoToClass" Style="@($"color:{Color}; background:transparent;")" Variant="Variant.Text" DropShadow="true">
        <img src="@MyIcon.Anvil_white" width="25px" height="24px" class="anvil-icon" />
        Class
    </MudButton>
    <MudButton OnClick="GoToCharacter" Style="@($"color:{Color}; background:transparent;")" Variant="Variant.Text" DropShadow="true">
        <img src="@MyIcon.Helm_white" width="25px" height="24px" class="helm-icon"  />
        Character
    </MudButton>
    <MudButton OnClick="GoToEquipment" Style="@($"color:{Color}; background:transparent;")" Variant="Variant.Text" DropShadow="true">
        <img src="@MyIcon.Chest" width="26px" height="25px" class="helm-icon" style="padding-bottom: 4px;" />
        Equipment
    </MudButton>
    <MudButton OnClick="GoToHealth" Style="@($"color:{Color}; background:transparent;")" Variant="Variant.Text" DropShadow="true" >
        <MudIcon Style="width:25px; height: 24px; padding: 2px; padding-bottom: 5px;" Icon="@Icons.Material.Filled.Favorite" aria-label="Health"></MudIcon>
        Health
    </MudButton>
    <MudButton Style="@($"color:{Color}; background:transparent;")" Variant="Variant.Text" DropShadow="true" Href="/campaignlist">
        <img src="@MyIcon.BookmarkWhite" width="24px" height="24px" class="helm-icon" style="padding-right: 3px;" />
        Campaign
    </MudButton>
</MudStack>


@code {

    [Parameter] public bool IsRow { get; set; } = true;
    [Parameter] public int Spaceing { get; set; } = 1;
    [Parameter]
    public EventCallback OnDrawerChanged { get; set; }

    public UserInfo? UserInfo { get; set; }
    private string Color = Colors.Gray.Lighten5;

    private async Task GoToClass()
    {
        try
        {

            UserInfo = await _userService.GetUserInfo();

            if (UserInfo is not null && UserInfo.SelectedCharacterId > 0)
            {
                string classLink = "/profession/" + UserInfo.SelectedCharacterId;
                await OnDrawerChanged.InvokeAsync();
                _navigationManager.NavigateTo(classLink);
            }
            else
            {
                _snackBar.Add("No character have yet been approved and selected as main", Severity.Info);
            }
        }
        catch (Exception e)
        {
            _snackBar.Add("Uknnown error", Severity.Error);
        }

    }
    private async Task GoToCharacterList()
    {
        try
        {
            string characterLink = "/character"; 
            await OnDrawerChanged.InvokeAsync();

            _navigationManager.NavigateTo(characterLink);

        }
        catch (Exception e)
        {
            _snackBar.Add("Uknnown error", Severity.Error);
        }

    }

    private async Task GoToCharacter()
    {
        try
        {
            UserInfo = await _userService.GetUserInfo();

            if (UserInfo is not null && UserInfo.SelectedCharacterId > 0)
            {
                string characterLink = "/character/edit/" + UserInfo.SelectedCharacterId;
                await OnDrawerChanged.InvokeAsync();

                _navigationManager.NavigateTo(characterLink);
            }
            else
            {
                _snackBar.Add("No character have yet been approved and selected as main", Severity.Info);
            }
        }
        catch (Exception e)
        {
            _snackBar.Add("Uknnown error", Severity.Error);
        }

    }
    private async Task GoToEquipment()
    {
        try
        {
            UserInfo = await _userService.GetUserInfo();

            if (UserInfo is not null && UserInfo.SelectedCharacterId > 0)
            {
                string characterLink = "/equipment/" + UserInfo.SelectedCharacterId;
                await OnDrawerChanged.InvokeAsync();

                _navigationManager.NavigateTo(characterLink);
            }
            else
            {
                _snackBar.Add("No character have yet been approved and selected as main", Severity.Info);
            }
        }
        catch (Exception e)
        {
            _snackBar.Add("Uknnown error", Severity.Error);
        }

    }

    private async Task GoToHealth()
    {
        try
        {
            UserInfo = await _userService.GetUserInfo();

            if (UserInfo is not null && UserInfo.SelectedCharacterId > 0)
            {
                string characterLink = "/health/" + UserInfo.SelectedCharacterId;
                await OnDrawerChanged.InvokeAsync();

                _navigationManager.NavigateTo(characterLink);
            }
            else
            {
                _snackBar.Add("No character have yet been approved and selected as main", Severity.Info);
            }
        }
        catch (Exception e)
        {
            _snackBar.Add("Uknnown error", Severity.Error);
        }

    }

}
