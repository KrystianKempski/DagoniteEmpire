
@page "/profession/{id:int}"
@using DA_DataAccess.CharacterClasses
@inject IJSRuntime _jsruntime
@inject ICharacterRepository _characterRepository
@inject IAttributeRepository _attributeRepository
@inject IProfessionRepository _professionRepository
@inject IEquipmentRepository _equipmentRepository
@inject ISpellRepository _spellRepository
@inject ISpellRepository _spellSlotRepository
@inject ISpellCircleRepository _spellCircleRepository
@inject IDialogService DialogService
@inject NavigationManager _navigationManager
@inject AuthenticationStateProvider GetAuthenticationStateAsync

@inject IJSRuntime _jsRuntime

<div class="main-table">

    @if (IsLoading)
    {
        <div class="text-center">
            <img src="/images/loading.gif">
        </div>
    }
    else
    {

        <label class="warnign-message">@ErrorMessage</label>
        <div class="wide-screen-table">
            <div class="d-flex ">
                <div class="d-flex flex-column px-1 flex-grow-1">
                    <label class="class-section py-1">Class name</label>
                    <SfTextBox Placeholder="Insert class name" @bind-Value="@ProfessionDTO.Name"></SfTextBox>
                </div>
                <div class="d-flex flex-column px-1">
                    <label class="class-section py-1">Related attribute</label>
                    <label class="prof-variables" style="width: 150px;">@ProfessionDTO.RelatedAttributeName</label>
                </div>
                @if (IsAdminOrMG)
                {
                    <div class="d-flex flex-column px-1">
                        <label class="column-section py-1">Class Level</label>
                        <SfNumericTextBox CssClass="prof-variables" Width="100px" ShowSpinButton="false" @bind-Value="@ProfessionDTO.ClassLevel" OnChange="ChangeProfLevel"></SfNumericTextBox>
                    </div>
                }
                else
                {
                    <div class="d-flex flex-column px-1">
                        <label class="column-section py-1">Class Level</label>
                        <label class="prof-variables">@ProfessionDTO.ClassLevel</label>
                    </div>
                }

                <div class="d-flex flex-column px-1">
                    <label class="column-section py-1">Skill roll</label>
                    <label class="prof-variables">@ProfessionDTO.ProfessionSkillRoll</label>
                </div>
                <div class="d-flex flex-column px-1">
                    <label class="column-section py-1">Focus points</label>
                    <label class="prof-variables">@ProfessionDTO.MaxFocusPoints</label>
                </div>
                @if (IsAdminOrMG)
                {
                    <div class="d-flex flex-column px-1">
                        <label class="class-section py-1">Approve</label>
                        <div class="justify-content-center mx-auto my-auto">
                            <SfCheckBox @bind-Checked="ProfessionDTO.IsApproved"></SfCheckBox>
                        </div>
                    </div>
                }
            </div>
        </div>
        <div class="short-screen-table">
            <div class="d-flex flex-column ">
                <div class="d-flex">
                    <div class="d-flex flex-column px-1 flex-grow-1">
                        <label class="class-section py-1">Class name</label>
                        <SfTextBox Placeholder="Insert class name" @bind-Value="@ProfessionDTO.Name"></SfTextBox>
                    </div>
                    @if (IsAdminOrMG)
                    {
                        <div class="d-flex flex-column px-1">
                            <label class="class-section py-1">Approve</label>
                            <div class="justify-content-center mx-auto my-auto">
                                <SfCheckBox @bind-Checked="ProfessionDTO.IsApproved"></SfCheckBox>
                            </div>
                        </div>
                    }
                </div>
                <div class="d-flex flex-column px-1">
                    <label class="class-section py-1">Related attribute</label>
                    <label class="prof-variables">@ProfessionDTO.RelatedAttributeName</label>
                </div>
                <div class="d-flex">
                    @if (IsAdminOrMG)
                    {
                        <div class="d-flex flex-column px-1 variables">
                            <label class="column-section py-1">Class Level</label>
                            <SfNumericTextBox ShowSpinButton="false" @bind-Value="@ProfessionDTO.ClassLevel" OnChange="ChangeProfLevel"></SfNumericTextBox>
                        </div>
                    }
                    else
                    {
                        <div class="d-flex flex-column px-1 variables">
                            <label class="column-section py-1">Class Level</label>
                            <label class="prof-variables">@ProfessionDTO.ClassLevel</label>
                        </div>
                    }

                    <div class="d-flex flex-column px-1 variables">
                        <label class="column-section py-1">Skill roll</label>
                        <label class="prof-variables">@ProfessionDTO.ProfessionSkillRoll</label>
                    </div>
                    <div class="d-flex flex-column px-1 variables">
                        <label class="column-section py-1">Focus points</label>
                        <label class="prof-variables">@ProfessionDTO.MaxFocusPoints</label>
                    </div>
                </div>

            </div>

        </div>
        <div class="d-flex flex-column flex-grow-1 mx-1">
            <label class="class-section">Class description</label>
            <SfRichTextEditor Height="300px" @ref="DescrEdit" @bind-Value="@ProfessionDTO.Description">
                <RichTextEditorToolbarSettings Items="@Tools" Type="ToolbarType.MultiRow" />
            </SfRichTextEditor>
        </div>

        <MudTabs Elevation="0" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-2">
            <MudTabPanel Text="Active class skills" Style="font-weight: bold;">
                @*  ACTIVE SKILLS  *@
                <div class="wide-screen-table mx-1">

                    <table class="table align-middle">
                        <thead>
                            <tr>
                                <th scope="col" class="level-row text-center">Level</th>
                                <th scope="col" class="name-row text-center">Name</th>
                                <th scope="col" class="descr-row text-center">Description</th>
                                <th scope="col" class="number-row text-center">DC</th>
                                <th scope="col" class="number-row text-center">Cost</th>
                                <th scope="col" class="number-row text-center">Range</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var skill in ProfessionDTO.ActiveSkills)
                            {
                                <tr>
                                    @if (skill.Index % 2 == 0)
                                    {
                                        <td rowspan="2"> <label class="short-row">@skill.Level</label> </td>
                                    }
                                    <td> <div class="name-cell"> <SfTextBox Placeholder="Insert skill name" @bind-Value="@skill.Name"></SfTextBox> </div> </td>
                                    <td>
                                        <div class="bonus-double-cell">
                                            <SfTextBox ID="@skill.Index.ToString()" OnChange="@(()=>ChangeDescription(skill.Index))" Multiline=true Placeholder="Insert skill description" @bind-Value="@skill.Description">
                                            </SfTextBox>
                                        </div>
                                    </td>
                                    <td><div class="short-row"><SfNumericTextBox ShowSpinButton="false" @bind-Value="@skill.DC"></SfNumericTextBox></div></td>
                                    <td><div class="short-row"><SfNumericTextBox ShowSpinButton="false" @bind-Value="@skill.Cost"></SfNumericTextBox></div></td>
                                    <td><div class="short-row"><SfTextBox @bind-Value="@skill.Range"></SfTextBox></div></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <div class="short-screen-table mx-1">

                    <table class="table align-middle">
                        <thead>
                            <tr>
                                <th scope="col" class="level-row text-center">Level</th>
                                <th scope="col" class="name-row text-center">Name</th>
                                <th scope="col" class="number-row text-center">DC</th>
                                <th scope="col" class="number-row text-center">Cost</th>
                                <th scope="col" class="number-row text-center"> Range</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var skill in ProfessionDTO.ActiveSkills)
                            {
                                <tr>
                                    @if (skill.Index % 2 == 0)
                                    {
                                        <td rowspan="4"> <label class="short-row">@skill.Level</label> </td>
                                    }
                                    <td> <div class="name-cell"> <SfTextBox Placeholder="Insert skill name" @bind-Value="@skill.Name"></SfTextBox> </div> </td>

                                    <td><div class="short-row"><SfNumericTextBox ShowSpinButton="false" @bind-Value="@skill.DC"></SfNumericTextBox></div></td>
                                    <td><div class="short-row"><SfNumericTextBox Format="" ShowSpinButton="false" @bind-Value="@skill.Cost"></SfNumericTextBox></div></td>
                                    <td><div class="short-row"><SfTextBox @bind-Value="@skill.Range"></SfTextBox></div></td>
                                </tr>
                                <tr>
                                    <td colspan="4">
                                        <SfTextBox ID="@skill.Index.ToString()" OnChange="@(()=>ChangeDescription(skill.Index))" Multiline=true Placeholder="Insert skill description" @bind-Value="@skill.Description">
                                        </SfTextBox>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

            </MudTabPanel>
            <MudTabPanel Text="Passive class skills" Style="font-weight: bold;">
                @*  PASSIVE SKILLS  *@

                <div class="wide-screen-table mx-1">

                    <table class="table align-middle">
                        <thead>
                            <tr>
                                <th scope="col" class="level-row text-center">Level</th>
                                <th scope="col" class="name-row text-center">Name</th>
                                <th scope="col" class="descr-row text-center">Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var skill in ProfessionDTO.PassiveSkills)
                            {
                                <tr>
                                    <td> <label class="short-row">@skill.Level</label> </td>
                                    <td> <div class="name-cell"> <SfTextBox Placeholder="Insert skill name" @bind-Value="@skill.Name"></SfTextBox> </div> </td>
                                    <td>
                                        <div class="bonus-double-cell">
                                            <SfTextBox ID="@skill.Index.ToString()" OnChange="@(()=>ChangeDescription(skill.Index))" Multiline=true Placeholder="Insert skill description" @bind-Value="@skill.Description">
                                            </SfTextBox>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <div class="short-screen-table mx-1">

                    <table class="table align-middle">
                        <thead>
                            <tr>
                                <th scope="col" class="number-row text-center">Level</th>
                                <th scope="col" class="name-row-short text-center">Name</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var skill in ProfessionDTO.PassiveSkills)
                            {
                                <tr>
                                    <td rowspan="2"> <label class="short-row">@skill.Level</label> </td>
                                    <td> <div class="name-cell"> <SfTextBox Placeholder="Insert skill name" @bind-Value="@skill.Name"></SfTextBox> </div> </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <SfTextBox ID="@skill.Index.ToString()" OnChange="@(()=>ChangeDescription(skill.Index))" Multiline=true Placeholder="Insert skill description" @bind-Value="@skill.Description">
                                        </SfTextBox>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

            </MudTabPanel>
            <MudTabPanel Text="Spells" Disabled="false" Style="font-weight: bold;">
                @*  SPELLS  *@
                <div class="spell-type my-2">
                    <InputSelect @bind-Value="ProfessionDTO.CasterType" class="form-select" @bind-Value:after="SpellcasterTypeHandle">
                        <option checked="@(ProfessionDTO.CasterType == SpellcasterType.Sorcerer)" value="@SpellcasterType.Sorcerer">
                            Sorcerer
                        </option>
                        <option checked="@(ProfessionDTO.CasterType == SpellcasterType.Wizard)" value="@SpellcasterType.Wizard">
                            Wizard
                        </option>
                    </InputSelect>
                </div>

                <MudTable RowClass="cell-small"  T="SpellCircleDTO" Items="@SpellCircles" Breakpoint="Breakpoint.Sm" @ref="CircleTable">
                    <HeaderContent>
                        <MudTh Style="text-align:center; width: 60px; padding: 4px;">Level</MudTh>
                        <MudTh Style="text-align:center; width: 60px; padding: 4px;">Known</MudTh>
                        <MudTh Style="text-align:center; width: 60px; padding: 4px;">PerDay</MudTh>
                        <MudTh Style="text-align:center; padding: 4px;">Spell slots</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd Style="text-align:center; width: 60px; padding: 4px; font-size:26px; font-weight:bold" DataLabel="Level">@context.Level</MudTd>
                        <MudTd Style="text-align:center; width: 60px; padding: 4px;" DataLabel="Known">@context.KnownSpells</MudTd>
                        <MudTd Style="text-align:center; width: 60px; padding: 4px;" DataLabel="PerDay">@context.PerDay</MudTd>
                        <MudTd Style="text-align:center; padding: 4px;" DataLabel="Spell slots">
                            <MudTable T="SpellSlot" Items="@context.SpellSlots" Hover="true" Breakpoint="Breakpoint.Sm">
                                <RowTemplate Context="slotContext">
                                    @if(slotContext.Spell is not null)
                                    {
                                        <MudTd Style="padding: 4px;" DataLabel="Prepared">
                                            <MudLink Href="@slotContext.Spell.Link">@slotContext.Spell.Name</MudLink>
                                        </MudTd>
                                    }
                                    else
                                    {
                                        <MudTd Style="padding: 4px;" DataLabel="Prepared">Select Spell</MudTd>
                                    }
                                    <MudTd Style="width: 60px; padding: 4px;" DataLabel="ready">
                                        
                                        <MudNumericField Class="dense-numeric-field text-center" IconSize="Size.Small"
                                                         ShrinkLabel="true" Value=@slotContext.Prepared ValueChanged="(int newValue)=>ChangePrepared(slotContext,context,newValue)" Immediate="true"
                                                         For="@(() => slotContext.Prepared)"  />
                                    </MudTd>
                                    <MudTd Style="width: 60px; padding: 4px;" DataLabel="actions">
                                        <div class="d-flex px-0">
                                            @if(slotContext.Spell is not null && string.IsNullOrEmpty(slotContext.Spell.Name) == false){
                                                <MudIconButton Style="width:30px; height: 30px; padding:1px;" OnClick="@(()=>SaveSpell(slotContext,true))" Icon="@Icons.Material.Filled.Edit" aria-label="Change spell"></MudIconButton>
                                                <MudIconButton Style="width:30px; height: 30px; padding:1px;"  OnClick="@(()=>DeleteSpell(slotContext))" Icon="@Icons.Material.Filled.Delete" aria-label="Delete spell"></MudIconButton>
                                            }else{
                                                <MudIconButton Style="width:30px; height: 30px; padding:1px;" OnClick="@(()=>SaveSpell(slotContext,false))" Icon="@Icons.Material.Filled.Add" aria-label="Add new spell"></MudIconButton>
                                            }
                                        </div>
                                    </MudTd>
                                </RowTemplate>
                            </MudTable>
                        </MudTd>
                    </RowTemplate>
                </MudTable>
                <button disabled="@IsSpellTypeDisabled" class="btn btn-secondary my-2" @onclick="AddSpellCircle">Add Spell Circle</button>
            </MudTabPanel>
        </MudTabs>

        <label class="warnign-message">@ErrorMessage</label>
        <div class="d-flex ">
            <button @onclick="OnSaveChangesBtnClick" class="btn btn-primary ma-2">Save</button>
            <button @onclick="OnCancelBtnClick" class="btn btn-secondary ma-2">Cancel</button>
        </div>
    }
</div>

           
<style>
    .dense-numeric-field .mud-input-control-input-container .mud-input-underline {
        margin-top: 0px !important;
    }
    .mud-input-control {
        margin-top: 0px !important;
    }
</style>


@code {

    [Parameter]
    public int Id { get; set; }
    public int AvalibleSpells { get; set; } = 0;
    public ProfessionDTO ProfessionDTO { get; set; } = new();
    private AllParamsModel AllParams { get; set; } = new();
    private SfRichTextEditor DescrEdit = new SfRichTextEditor();
    private ICollection<SpellCircleDTO> SpellCircles = new List<SpellCircleDTO>();
    private MudTable<SpellCircleDTO> CircleTable;
    [CascadingParameter]
    public Task<AuthenticationState> AuthenticationState { get; set; }

    private MudTable<SpellCircle> mudTable;


    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationState;
        if (!authState.User.Identity.IsAuthenticated)
        {
            var uri = new Uri(_navigationManager.Uri);
            _navigationManager.NavigateTo($"/identity/account/login?returnUrl={uri.LocalPath}", forceLoad: true);
        }
        var user = authState.User;
        if (user == null)
            return; // failed to load

        IsAdminOrMG = user.IsInRole(SD.Role_Admin) || user.IsInRole(SD.Role_GameMaster);
        ReadOnly = !IsAdminOrMG;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                IsLoading = true;

                StateHasChanged();

                await LoadCharacter();

                IsLoading = false;
                StateHasChanged();
            }
            catch (Exception ex)
            {
                IsLoading = false;
                await _jsruntime.ToastrError("Error while initialize: " + ex.ToString());
            }
        }
    }

    private async Task LoadCharacter()
    {

        AllParams.Character = await _characterRepository.GetById(Id);
        AllParams.Attributes = await _attributeRepository.GetAll(Id);
        //AllParams.Profession = await _professionRepository.GetById(AllParams.Character.ProfessionId);
        ProfessionDTO = await _professionRepository.GetById(AllParams.Character.ProfessionId);
        if(ProfessionDTO.SpellCircles is not null)
        {
            SpellCircles = ProfessionDTO.SpellCircles;
        }

        if (string.IsNullOrEmpty(ProfessionDTO.RelatedAttributeName))
            throw new Exception("No related class attribute");

        if (ProfessionDTO.CasterType != SpellcasterType.None)
            IsSpellTypeDisabled = false;

        var authstate = await GetAuthenticationStateAsync.GetAuthenticationStateAsync();
        var user = authstate.User;
        if (user == null)
            return; // failed to load

        IsAdminOrMG = user.IsInRole(SD.Role_Admin) || user.IsInRole(SD.Role_GameMaster);

        ProfessionDTO.CalculateClassParams(AllParams.Attributes);
    }

    private string ErrorMessage { get; set; } = string.Empty;
    private bool IsLoading { get; set; } = true;
    private bool IsSpellTypeDisabled { get; set; } = true;
    public bool IsAdminOrMG { get; set; } = false;
    public bool ReadOnly { get; set; } = false;

    public IEditorSettings EditParams = new NumericEditCellParams
    {
        Params = new NumericTextBoxModel<object>() { ShowClearButton = true, ShowSpinButton = false }
    };

    private List<ToolbarItemModel> Tools = new List<ToolbarItemModel>()
    {
        new ToolbarItemModel() { Command = ToolbarCommand.Bold },
        new ToolbarItemModel() { Command = ToolbarCommand.Italic },
        new ToolbarItemModel() { Command = ToolbarCommand.Underline },
        new ToolbarItemModel() { Command = ToolbarCommand.StrikeThrough },
        new ToolbarItemModel() { Command = ToolbarCommand.CreateLink },
        new ToolbarItemModel() { Command = ToolbarCommand.FullScreen },
    };
    public void ChangeDescription(uint args)
    {
        //pass ID(column name) of multiline textbox
        _jsruntime.InvokeVoidAsync("ResizeTextArea", $"{args}");
    }
    private async Task OnSaveChangesBtnClick()
    {
        try
        {
            if (string.IsNullOrEmpty(ProfessionDTO.Name) || string.IsNullOrEmpty(ProfessionDTO.Description))
            {
                throw new WarningException("Create name and description of class");
            }
            if (string.IsNullOrEmpty(ProfessionDTO.RelatedAttributeName))
            {
                throw new WarningException("Choose class related attribute");
            }

            // await _spellCircleRepository.Update()
            ProfessionDTO.SpellCircles = SpellCircles;

            await _professionRepository.Update(ProfessionDTO);

            _navigationManager.NavigateTo("#");
            ErrorMessage = string.Empty;
        }
        catch (WarningException ex)
        {
            IsLoading = false;
            await _jsRuntime.ToastrWarning(ex.ToString());
        }
        catch (Exception ex)
        {
            IsLoading = false;
            await _jsRuntime.ToastrError("Error while initialize: " + ex.ToString());
        }
    }
    private async Task OnCancelBtnClick()
    {
        _navigationManager.NavigateTo("#");
    }

    private async Task ChangeProfLevel()
    {
        try
        {
            ProfessionDTO.CalculateClassParams(AllParams.Attributes);
            StateHasChanged();
        }
        catch (WarningException ex)
        {
            IsLoading = false;
            await _jsRuntime.ToastrWarning(ex.ToString());
        }
        catch (Exception ex)
        {
            IsLoading = false;
            await _jsRuntime.ToastrError("Error while initialize: " + ex.ToString());
        }
    }

    private async Task ChangeRelatedAttribute(string attrName)
    {
        try
        {
            if (attrName != null && attrName != "0")
            {
                ProfessionDTO.RelatedAttributeName = attrName;
                ProfessionDTO.RelatedAttribute = AllParams.Attributes.FirstOrDefault(a => a.Name == attrName);
                ProfessionDTO.CalculateClassParams(AllParams.Attributes);
                StateHasChanged();
                return;
            }
        }
        catch(WarningException ex){
            IsLoading = false;
            await _jsRuntime.ToastrWarning(ex.ToString());
        }
        catch (Exception ex)
        {
            IsLoading = false;
            await _jsRuntime.ToastrError("Error while initialize: " + ex.ToString());
        }
    }

    private async Task AddSpellCircle()
    {
        try{
            int newLevel = SpellCircles.Count();
            if (newLevel > 9)
                throw new WarningException("Max spell circle level reached");
            SpellCircleDTO circle = new();
            circle.ProfessionId = ProfessionDTO.Id;
            circle.Profession = ProfessionDTO;
            circle.Level = newLevel;
            circle.CalculateSpells();
            circle.SpellSlots = new List<SpellSlot>();
            for(int i=0; i < circle.KnownSpells; i++)
            {
                circle.SpellSlots.Add(new SpellSlot());
            }

            SpellCircles.Add(circle);
            StateHasChanged();
        } 
        catch(WarningException ex){
            IsLoading = false;
            await _jsRuntime.ToastrWarning(ex.ToString());
        }
        catch (Exception ex)
        {
            IsLoading = false;
            await _jsRuntime.ToastrError("Error while initialize: " + ex.ToString());
        }
    }

    private void SpellcasterTypeHandle()
    {
        IsSpellTypeDisabled = false;

        if (ProfessionDTO.CasterType != SpellcasterType.None)
        {
            if(ProfessionDTO.SpellCircles is not null){

                foreach(var circle in ProfessionDTO.SpellCircles)
                {
                    if (circle.SpellSlots is not null)
                    {
                        foreach(var slot in circle.SpellSlots)
                        {
                            if (ProfessionDTO.CasterType == SpellcasterType.Sorcerer)
                            {
                                slot.Prepared = circle.PerDay;
                            }
                            else 
                            {
                                slot.Prepared = 0;
                            }
                        }
                    }
                }
            }
        }
    }

    private async Task SaveSpell(SpellSlot? spellSlot, bool isEdit)
    {
        if (spellSlot is null)
            return;

        Spell spell = new();
        if (isEdit && spellSlot.Spell is not null)
        {
            spell.Id = spellSlot.Spell.Id;
            spell.Level = spellSlot.Spell.Level;
            spell.Description = spellSlot.Spell.Description;
            spell.Link = spellSlot.Spell.Link;
            spell.Name = spellSlot.Spell.Name;
            spell.IsApproved = spellSlot.Spell.IsApproved;
        }
        var parameters = new DialogParameters<SpellDialog> { { x => x.Spell, spell }, { x => x.IsEdit, isEdit }, { x => x.IsAdminOrMG, IsAdminOrMG } };
        var dialog = await DialogService.ShowAsync<SpellDialog>("Edit spell", parameters);
        var result = await dialog.Result;

        if (!result.Canceled)
        {
            spellSlot.Spell = (Spell)result.Data;
            StateHasChanged();
        }
    }

    public async Task ChangePrepared(SpellSlot slot, SpellCircleDTO circle, int newValue) // your model.Amt type
    {

        int allPreparedSpells = 0;
        //FOR WIZZARD 
        if (ProfessionDTO.CasterType == SpellcasterType.Wizard)
        {
            if(circle.SpellSlots is not null){
                foreach(var s in circle.SpellSlots)
                {
                    allPreparedSpells += s.Prepared;
                }
            }
            //adding
            if (slot.Prepared < newValue)
            {
                if (circle.PerDay - allPreparedSpells > 0)
                {
                    slot.Prepared = newValue;
                }

            }
            //refracting
            if (slot.Prepared > newValue && slot.Prepared > 0 )
            {
                slot.Prepared = newValue;
            }
        }
        else if (ProfessionDTO.CasterType == SpellcasterType.Sorcerer)
        {
            allPreparedSpells = slot.Prepared;
            //adding
            if (slot.Prepared < newValue)
            {
                if (circle.PerDay - allPreparedSpells > 0)
                {
                    slot.Prepared = newValue;
                }

            }
            //refracting
            if (slot.Prepared > newValue && slot.Prepared > 0)
            {
                slot.Prepared = newValue;
            }
            if (circle.SpellSlots is not null)
            {
                foreach (var s in circle.SpellSlots)
                {
                    s.Prepared = slot.Prepared;
                }
            }
        }

    }

    private async Task DeleteSpell(SpellSlot spellSlot)
    {

    }
}
